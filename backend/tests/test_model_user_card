from backend.app.models.user_card import UserCard
from backend.app.models.card_model import Card
from backend.app.models.user_model import User

@pytest.fixture(scope="module")
def create_user_and_card(db_session):
    """Fixture pour créer un utilisateur et une carte de test"""
    user = User(
        username="test_user",
        password="test_password",
        role=Role.USER,
        e_mail="test@example.com"
    )
    db_session.add(user)
    db_session.commit()

    card = Card(id=1, name="Test Card", image_url="http://example.com", rarity="Rare")
    db_session.add(card)
    db_session.commit()

    user_card = UserCard(user_id="test_user", card_id=1, obtained=True)
    db_session.add(user_card)
    db_session.commit()

    return user, card, user_card

def test_user_card_relationship(create_user_and_card, db_session):
    """Test de la relation entre un utilisateur et une carte"""
    user, card, user_card = create_user_and_card

    # Vérifie que la liaison utilisateur-carte existe
    user_card = db_session.query(UserCard).filter(UserCard.user_id == "test_user").first()
    assert user_card is not None
    assert user_card.user_id == "test_user"
    assert user_card.card_id == 1
    assert user_card.obtained is True
